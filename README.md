# st_book - SillyTavern 世界书和角色卡自动生成工具\n\n基于AI智能分析小说文本，自动生成高质量的角色卡和世界书，支持统一配置管理和完整的工作流程。\n\n## 🌟 主要特性\n\n- **智能角色提取**：使用AI分析小说文本，自动识别和提取角色信息\n- **角色智能合并**：自动识别重复角色并进行智能合并，避免冗余\n- **角色质量筛选**：按内容丰富度自动筛选最重要的角色\n- **世界书生成**：自动提取世界观设定，生成结构化世界书\n- **统一配置管理**：所有参数可通过配置文件统一管理\n- **完整工作流**：从小说文本到SillyTavern可用资源的一键生成\n\n## 🚀 快速开始\n\n### 1. 环境准备\n\n```bash\n# 克隆项目\ngit clone https://github.com/nariahlamb/st_book.git\ncd st_book\n\n# 安装依赖\npip install -r requirements.txt\n```\n\n### 2. 配置设置\n\n复制配置模板并填入您的API信息：\n\n```bash\ncp config_template.yaml config.yaml\n```\n\n编辑 `config.yaml` 文件，填入您的API配置：\n\n```yaml\napi:\n  api_key: \"YOUR_API_KEY_HERE\"  # 您的API密钥\n  api_base: \"https://api.openai.com/v1\"  # API基础URL\n```\n\n### 3. 准备小说文件\n\n将您的小说文本文件命名为 `a.txt` 并放在项目根目录，或在配置文件中修改 `input.source_file` 路径。\n\n### 4. 一键生成\n\n#### 生成角色卡：\n```bash\npython character_workflow.py auto\n```\n\n#### 生成世界书：\n```bash\npython character_workflow.py wb-auto\n```\n\n## 📁 项目结构\n\n```\nst_book/\n├── character_workflow.py      # 主工作流脚本\n├── config_template.yaml       # 配置文件模板\n├── project_config.py          # 配置管理器\n├── character_extractor_llm.py # 角色提取模块\n├── character_merger.py        # 角色合并模块\n├── character_filter.py        # 角色筛选模块\n├── create_card.py             # 角色卡生成模块\n├── worldbook_extractor.py     # 世界书提取模块\n├── worldbook_generator.py     # 世界书生成模块\n├── text_splitter.py           # 文本分割模块\n├── code.py                    # 格式转换模块\n└── README.md                  # 项目说明\n```\n\n## 🔧 详细使用\n\n### 角色卡生成流程\n\n```bash\n# 完整自动流程（推荐）\npython character_workflow.py auto\n\n# 分步执行\npython character_workflow.py split      # 分割文本\npython character_workflow.py extract    # 提取角色\npython character_workflow.py merge      # 合并角色\npython character_workflow.py filter     # 筛选角色\npython character_workflow.py create     # 生成角色卡\n```\n\n### 世界书生成流程\n\n```bash\n# 完整自动流程（推荐）\npython character_workflow.py wb-auto\n\n# 分步执行\npython character_workflow.py wb-extract    # 提取世界书条目\npython character_workflow.py wb-generate   # 生成结构化世界书\n```\n\n### 配置验证\n\n```bash\npython verify_config_usage.py  # 验证配置使用情况\n```\n\n## ⚙️ 配置说明\n\n### 核心配置项\n\n- **API配置**：`api.api_key` 和 `api.api_base`\n- **模型配置**：`models.extraction_model` 和 `models.generation_model`\n- **温度参数**：`models.extraction_temperature` 和 `models.generation_temperature`\n- **角色筛选**：`character_filter.keep_count` 控制保留的角色数量\n- **相似度阈值**：`similarity.name_threshold` 控制角色合并的严格程度\n\n### 输出目录\n\n- `cards/` - 生成的角色卡文件\n- `worldbook/` - 生成的世界书文件\n- `roles_json/` - 合并后的角色数据\n- `chunks/` - 分割的文本块\n\n## 🎯 输出格式\n\n### 角色卡格式\n- 支持SillyTavern V2格式\n- 包含角色名称、描述、性格、说话习惯等\n- 自动生成多个开场白\n\n### 世界书格式\n- 支持SillyTavern V2世界书格式\n- 智能分类：角色、地点、概念、物品等\n- 结构化条目，便于检索\n\n## 🔍 故障排除\n\n### 常见问题\n\n1. **API调用失败**：检查API密钥和网络连接\n2. **角色提取为空**：检查小说文本格式和编码\n3. **内存不足**：调整 `text_processing.max_chunk_chars` 参数\n4. **生成速度慢**：调整 `performance.max_concurrent` 参数\n\n### 日志查看\n\n项目会在各个阶段输出详细日志，帮助诊断问题。\n\n## 🤝 贡献\n\n欢迎提交Issue和Pull Request来改进项目！\n\n## 📄 许可证\n\n本项目采用MIT许可证。\n\n## 🙏 致谢\n\n感谢所有为这个项目做出贡献的开发者和用户！"